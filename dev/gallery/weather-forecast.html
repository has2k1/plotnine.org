<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.16">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John T. Randolph">

<title>Weather Forecast – plotnine 0.15.0</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/favicon-32x32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dd755132419e67449ef99e0994c660a4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-167b476174dea9c2aed737ddb5f4eea1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script defer="" data-domain="plotnine.org" src="https://plausible.io/js/script.js"></script>


<meta property="og:title" content="Weather Forecast – plotnine 0.15.0">
<meta property="og:description" content="">
<meta property="og:image" content="https://plotnine.org/gallery/img/misc/weather-forecast/weather.png">
<meta property="og:site_name" content="plotnine 0.15.0">
<meta property="og:image:height" content="650">
<meta property="og:image:width" content="650">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">plotnine 0.15.0</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../guide/install.html"> 
<span class="menu-text">Guide</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../gallery/index.html"> 
<span class="menu-text">Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-pages" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Pages</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-pages">    
        <li>
    <a class="dropdown-item" href="../changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/has2k1/plotnine"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#imports" id="toc-imports" class="nav-link active" data-scroll-target="#imports">Imports</a></li>
  <li><a href="#first-prototype" id="toc-first-prototype" class="nav-link" data-scroll-target="#first-prototype">First prototype</a>
  <ul class="collapse">
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#create-plot" id="toc-create-plot" class="nav-link" data-scroll-target="#create-plot">Create plot</a></li>
  <li><a href="#prototype-1-learnings" id="toc-prototype-1-learnings" class="nav-link" data-scroll-target="#prototype-1-learnings">Prototype 1 learnings</a></li>
  </ul></li>
  <li><a href="#second-prototype" id="toc-second-prototype" class="nav-link" data-scroll-target="#second-prototype">Second prototype</a>
  <ul class="collapse">
  <li><a href="#import-data-1" id="toc-import-data-1" class="nav-link" data-scroll-target="#import-data-1">Import data</a></li>
  <li><a href="#create-plot-1" id="toc-create-plot-1" class="nav-link" data-scroll-target="#create-plot-1">Create plot</a>
  <ul class="collapse">
  <li><a href="#no-group-aesthetic" id="toc-no-group-aesthetic" class="nav-link" data-scroll-target="#no-group-aesthetic">No <code>group</code> aesthetic?</a></li>
  <li><a href="#extra-geom_path-testing" id="toc-extra-geom_path-testing" class="nav-link" data-scroll-target="#extra-geom_path-testing">Extra <code>geom_path</code> testing</a></li>
  </ul></li>
  <li><a href="#prototype-2-learnings" id="toc-prototype-2-learnings" class="nav-link" data-scroll-target="#prototype-2-learnings">Prototype 2 learnings</a></li>
  </ul></li>
  <li><a href="#temperature-info-prototypes" id="toc-temperature-info-prototypes" class="nav-link" data-scroll-target="#temperature-info-prototypes">Temperature info prototypes</a>
  <ul class="collapse">
  <li><a href="#color-gradient-prototype" id="toc-color-gradient-prototype" class="nav-link" data-scroll-target="#color-gradient-prototype">Color gradient prototype</a></li>
  <li><a href="#full-temperature-prototype" id="toc-full-temperature-prototype" class="nav-link" data-scroll-target="#full-temperature-prototype">Full temperature prototype</a></li>
  <li><a href="#temperature-info-prototype-learnings" id="toc-temperature-info-prototype-learnings" class="nav-link" data-scroll-target="#temperature-info-prototype-learnings">Temperature info prototype learnings</a></li>
  </ul></li>
  <li><a href="#final-plot" id="toc-final-plot" class="nav-link" data-scroll-target="#final-plot">Final plot</a>
  <ul class="collapse">
  <li><a href="#prep-data" id="toc-prep-data" class="nav-link" data-scroll-target="#prep-data">Prep data</a></li>
  <li><a href="#plot-without-weather-icons" id="toc-plot-without-weather-icons" class="nav-link" data-scroll-target="#plot-without-weather-icons">Plot without weather icons</a></li>
  <li><a href="#plot-with-weather-icons" id="toc-plot-with-weather-icons" class="nav-link" data-scroll-target="#plot-with-weather-icons">Plot with weather icons</a></li>
  </ul></li>
  <li><a href="#concluding-notes" id="toc-concluding-notes" class="nav-link" data-scroll-target="#concluding-notes">Concluding notes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Weather Forecast</h1>
  <div class="quarto-categories">
    <div class="quarto-category">range</div>
    <div class="quarto-category">contest</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John T. Randolph </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>The code in this jupyter notebook walks through generating plots to represent a 7 day forecast (inspired by the Apple Weather app) using <code>plotnine</code>. Here is an example of a finished plot:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/misc/weather-forecast/weather.png" class="img-fluid figure-img"></p>
<figcaption>7-day forecast</figcaption>
</figure>
</div>
<p>The plot uses: * <code>geom_path</code> to draw temperature ranges (<code>geom_line</code> would have worked just as well) * <code>geom_text</code> to label the high and low temperatures * <code>watermark</code> to display the weather icons</p>
<p>The remaining plot components are the <code>title</code>, <code>subtitle</code>, and <code>y-axis</code> labels.</p>
<p>The icons were modified from the open source icon library, <a href="https://icons.getbootstrap.com/">Bootstrap Icons</a>: I colorized the icons and saved them as PNGs. Thanks to the Bootstrap team and contributors for Bootstrap Icons and the Bootstrap framework.</p>
<p>The trickier parts of creating this plot are getting the color gradient right and positioning the icons. The most time-consuming part is tweaking the plot’s theme to polish the plot’s look including placement and styling of elements.</p>
<p>If you want to skip past the prototypes that eventually led to the final product, jump to the <a href="#final-plot">Final Plot</a> section. After working out how I want the plot to look, I write a function to facilitate generating additional plots at the end of this notebook.</p>
<section id="imports" class="level2">
<h2 class="anchored" data-anchor-id="imports">Imports</h2>
<p>The code uses <code>polars</code> to read in the raw data and manipulate it to be ready to create the plot in <code>plotnine</code>. Here is an example table of raw data:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Day</th>
<th>Low</th>
<th>High</th>
<th>Conditions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Today</td>
<td>65</td>
<td>77</td>
<td>Cloudy</td>
</tr>
<tr class="even">
<td>Mon</td>
<td>61</td>
<td>84</td>
<td>Sunny</td>
</tr>
<tr class="odd">
<td>Tue</td>
<td>67</td>
<td>93</td>
<td>Hot</td>
</tr>
<tr class="even">
<td>Wed</td>
<td>59</td>
<td>76</td>
<td>Drizzle</td>
</tr>
<tr class="odd">
<td>Thu</td>
<td>54</td>
<td>75</td>
<td>Windy</td>
</tr>
<tr class="even">
<td>Fri</td>
<td>57</td>
<td>81</td>
<td>Party cloudy</td>
</tr>
<tr class="odd">
<td>Sat</td>
<td>60</td>
<td>71</td>
<td>Heavy rain</td>
</tr>
</tbody>
</table>
<div id="258d2ed8" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotnine <span class="im">as</span> p9</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pl.__version__, p9.__version__</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>('1.31.0', '0.15.0')</code></pre>
</div>
</div>
</section>
<section id="first-prototype" class="level1">
<h1>First prototype</h1>
<p>Let’s generate a first prototype of a plot to figure out if/how the data needs to be prepped for plotting, try out different strategies, and get a feel for how the data can be represented. This first prototype tries using <code>geom_segment</code>, but the final plot uses <code>geom_path</code>.</p>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">Import data</h2>
<p><code>geom_segment</code> requires <code>x</code>, <code>xend</code>, <code>y</code>, and <code>yend</code> aesthetics. We can map “Low” and “High” to <code>x</code> and <code>xend</code>, respectively, and “Day” to <code>y</code> and <code>yend</code>.</p>
<p>We can use the raw data with <code>geom_segment</code> with minimal work: we’ll just want to type the “Day” column as a categorical column to establish the correct plotting order. If we don’t do this, the days will be plot in alphabetical order.</p>
<p>Since this is just a 7-day forecast, we don’t need to worry about non-unique “Day” values. If there were non-unique “Day” values, we would need a different strategy such as using a unique value to order the days while using the “Day” value for labeling.</p>
<p>Don’t be concerned about the “Conditions” column for now. We’ll figure out what, if anything, to do with it after figuring out most of the other parts.</p>
<div id="9b004163" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>io <span class="op">=</span> StringIO(<span class="st">"""</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">Day,Low,High,Conditions</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">Today,65,77,Cloudy</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="st">Mon,61,84,Sunny</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">Tue,67,93,Hot</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="st">Wed,59,76,Drizzle</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">Thu,54,75,Windy</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">Fri,57,81,Partly cloudy</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">Sat,60,71,Heavy rain</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> pl.read_csv(io)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> raw_data.with_columns(pl.col(<span class="st">'Day'</span>).cast(pl.Categorical))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>raw_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Conditions</th>
</tr>
<tr class="even">
<td>cat</td>
<td>i64</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>65</td>
<td>77</td>
<td>"Cloudy"</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>61</td>
<td>84</td>
<td>"Sunny"</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>67</td>
<td>93</td>
<td>"Hot"</td>
</tr>
<tr class="even">
<td>"Wed"</td>
<td>59</td>
<td>76</td>
<td>"Drizzle"</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>54</td>
<td>75</td>
<td>"Windy"</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>57</td>
<td>81</td>
<td>"Partly cloudy"</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>60</td>
<td>71</td>
<td>"Heavy rain"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="create-plot" class="level2">
<h2 class="anchored" data-anchor-id="create-plot">Create plot</h2>
<p>I’m not showing the most basic prototype below, but if you want to see it, comment out line 4 and uncomment line 5 in the code block below.</p>
<p>From the most basic prototype, I made the design choices that I want a thicker line, I want round ends, and I want color in the line, ideally a color gradient. The first prototype on display below shows attempts at working towards the design choices.</p>
<div id="8ae918c8" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(raw_data, p9.aes(x<span class="op">=</span><span class="st">'Low'</span>, xend<span class="op">=</span><span class="st">'High'</span>, y<span class="op">=</span><span class="st">'Day'</span>, yend<span class="op">=</span><span class="st">'Day'</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">'Prototype 1'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_segment(size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-5-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prototype-1-learnings" class="level2">
<h2 class="anchored" data-anchor-id="prototype-1-learnings">Prototype 1 learnings</h2>
<p>The plot is starting to come together a little bit but there are a few things to take from this prototype:</p>
<ol type="1">
<li>The days are on the y-axis where low ordinality is at the bottom and high ordinality is at the top (opposite of what I want)</li>
<li>The line ends are not rounded</li>
<li>A color gradient is going to require some work</li>
</ol>
<p>There are a couple of strategies we can use to get the days ordered the way I want: we can either reverse the ordinality of the days in the dataframe or we can flip the y-axis. We can’t use <code>scale_y_reverse</code> because we do not have continuous values, but we can use <code>scale_y_discrete</code> and set the limits in reverse order. I use <code>scale_y_discrete</code> to reverse the order as demonstrated below.</p>
<div id="79f4ac16" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reverse order of the days with scale_y_discrete</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    plot</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">'Prototype 1'</span>, caption<span class="op">=</span><span class="st">'Fix day order'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(limits<span class="op">=</span>raw_data[<span class="st">'Day'</span>].reverse().to_list())</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-6-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It looks like <code>geom_segment</code> doesn’t produce round ends although the code specifies <code>lineend='round'</code>. I’d like to dig into the code a bit to see if this observation might be similar to this <a href="https://github.com/has2k1/plotnine/issues/727">issue</a> and <a href="https://github.com/has2k1/plotnine/commit/18b748fab0c8b0c6e9ab28090982ecf2c054cefc">commit</a> <del>but I don’t have cycles available to do that right now</del>. It took me a couple weeks to get to it but taking a look at the <a href="https://github.com/has2k1/plotnine/blob/main/plotnine/geoms/geom_segment.py"><code>geom_segment</code></a> code, I believe that <code>geom_segment</code> does not pass on the value of <code>lineend</code> and it can be solved similarly to the commit noted above; I’ve opened an <a href="https://github.com/has2k1/plotnine/issues/854">issue</a>.</p>
<p>Before moving on, let’s try one thing with <code>geom_segment</code> and a color gradient. I create a simple dataframe that has data to draw horizontal line segments at y=1. Each line segment has a <code>z</code> value ranging from 0 - 1 which we map to the color aesthetic.</p>
<div id="cee43c06" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> pl.DataFrame({</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'x'</span>: <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'y'</span>: [<span class="dv">1</span>] <span class="op">*</span> <span class="dv">10</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'z'</span>: [<span class="dv">0</span>] <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> [<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>]  <span class="op">+</span> [<span class="dv">1</span>] <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}, strict<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> plot_data.with_columns(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    xend <span class="op">=</span> pl.col(<span class="st">'x'</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>plot_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">z</th>
<th data-quarto-table-cell-role="th">xend</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>0.0</td>
<td>2</td>
</tr>
<tr class="even">
<td>2</td>
<td>1</td>
<td>0.0</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1</td>
<td>0.0</td>
<td>4</td>
</tr>
<tr class="even">
<td>4</td>
<td>1</td>
<td>0.2</td>
<td>5</td>
</tr>
<tr class="odd">
<td>5</td>
<td>1</td>
<td>0.4</td>
<td>6</td>
</tr>
<tr class="even">
<td>6</td>
<td>1</td>
<td>0.6</td>
<td>7</td>
</tr>
<tr class="odd">
<td>7</td>
<td>1</td>
<td>0.8</td>
<td>8</td>
</tr>
<tr class="even">
<td>8</td>
<td>1</td>
<td>1.0</td>
<td>9</td>
</tr>
<tr class="odd">
<td>9</td>
<td>1</td>
<td>1.0</td>
<td>10</td>
</tr>
<tr class="even">
<td>10</td>
<td>1</td>
<td>1.0</td>
<td>11</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="ca7bbd2f" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data, p9.aes(x<span class="op">=</span><span class="st">'x'</span>, xend<span class="op">=</span><span class="st">'xend'</span>, y<span class="op">=</span><span class="st">'y'</span>, yend<span class="op">=</span><span class="st">'y'</span>, color<span class="op">=</span><span class="st">'z'</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(caption<span class="op">=</span><span class="st">'Color gradient testing'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_segment(size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-8-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here’s the start of a color gradient effect, but we’ll need a lot more segments to get a smooth gradient. If you zoom in and take a close look at the segments, there are seams between the segments and there’s still the issue with not having rounded ends. We could deal with the seams by plotting overlapping line segments and try using <code>geom_point</code>s to simulate rounded ends, but these workarounds suggest that it’s worth considering what other approaches might be out there. Let’s move on to trying <code>geom_path</code>.</p>
</section>
</section>
<section id="second-prototype" class="level1">
<h1>Second prototype</h1>
<p>Let’s try using <code>geom_path</code>; this is a geom that I almost never use, but its <a href="https://plotnine.org/reference/geom_path.html">reference page</a> shows a promising example with a color gradient at the very bottom. We’ll try here again to get a rounded end too. In retrospect, I could have used <code>geom_line</code> instead, but the reference page for <code>geom_path</code> is where the inspiration for the color gradient originated from.</p>
<section id="import-data-1" class="level2">
<h2 class="anchored" data-anchor-id="import-data-1">Import data</h2>
<p><code>geom_path</code> requires <code>x</code> and <code>y</code> aesthetics where it connects points according to their order in the dataframe. I want to map a temperature to <code>x</code> and “Day” to <code>y</code>, so I need the Low and High temperatures for each day to be separated to different rows. This will require reshaping the data: in this case, we’ll melt the data from wide to long format so that we have “Temperature” (<code>x</code>) and “Day” (<code>y</code>) columns.</p>
<p>I’m going to work from the raw_data that was read in previously where Day is a categorical column.</p>
<div id="637386c9" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> (</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    raw_data</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    .unpivot(index<span class="op">=</span>[<span class="st">'Day'</span>], on<span class="op">=</span>[<span class="st">'High'</span>, <span class="st">'Low'</span>], variable_name<span class="op">=</span><span class="st">'Low/High'</span>, value_name<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    .sort([<span class="st">'Day'</span>, <span class="st">'Temperature'</span>], descending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plot_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (14, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Low/High</th>
<th data-quarto-table-cell-role="th">Temperature</th>
</tr>
<tr class="even">
<td>cat</td>
<td>str</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>"Low"</td>
<td>65</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>"High"</td>
<td>77</td>
</tr>
<tr class="odd">
<td>"Mon"</td>
<td>"Low"</td>
<td>61</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>"High"</td>
<td>84</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>"Low"</td>
<td>67</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>"High"</td>
<td>75</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>"Low"</td>
<td>57</td>
</tr>
<tr class="odd">
<td>"Fri"</td>
<td>"High"</td>
<td>81</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>"Low"</td>
<td>60</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"High"</td>
<td>71</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="create-plot-1" class="level2">
<h2 class="anchored" data-anchor-id="create-plot-1">Create plot</h2>
<p>I had imagined/hoped that <code>geom_path</code> might be able to auto-calculate a color gradient for the line between each of the two points, but ultimately the plot below demonstrates that this isn’t the case.</p>
<div id="db085a44" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data, p9.aes(x<span class="op">=</span><span class="st">'Temperature'</span>, y<span class="op">=</span><span class="st">'Day'</span>, color<span class="op">=</span><span class="st">'Temperature'</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">'Prototype 2'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(limits<span class="op">=</span>raw_data[<span class="st">'Day'</span>].reverse().to_list())</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-10-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="no-group-aesthetic" class="level3">
<h3 class="anchored" data-anchor-id="no-group-aesthetic">No <code>group</code> aesthetic?</h3>
<p>You might have noticed that the code above doesn’t map anything to the <code>group</code> aesthetic. Initially, I mapped “Day” to the <code>group</code> aesthetic, but it doesn’t appear to matter in this case. I believe it’s because <code>y</code> is mapped to discrete rather than continuous values. Look at the plot below to see what happens if <code>y</code> is mapped to continuous values without a <code>group</code> aesthetic.</p>
<p>Since we’ll have continuous values, we can use <code>scale_y_reverse</code> to reverse the order of the days.</p>
<div id="05cbc090" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prep dictionary to map days to numbers</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>days <span class="op">=</span> plot_data.get_column(<span class="st">'Day'</span>).unique(maintain_order<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>days <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(days, <span class="bu">range</span>(days.<span class="bu">len</span>())))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>days</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>{'Today': 0, 'Mon': 1, 'Tue': 2, 'Wed': 3, 'Thu': 4, 'Fri': 5, 'Sat': 6}</code></pre>
</div>
</div>
<div id="9158b599" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert days to numbers in "Day_int" column</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>plot_data_test <span class="op">=</span> plot_data.with_columns(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'Day'</span>).cast(<span class="bu">str</span>).replace(days).cast(<span class="bu">int</span>).alias(<span class="st">'Day_int'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plot_data_test</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (14, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Low/High</th>
<th data-quarto-table-cell-role="th">Temperature</th>
<th data-quarto-table-cell-role="th">Day_int</th>
</tr>
<tr class="even">
<td>cat</td>
<td>str</td>
<td>i64</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>"Low"</td>
<td>65</td>
<td>0</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>"High"</td>
<td>77</td>
<td>0</td>
</tr>
<tr class="odd">
<td>"Mon"</td>
<td>"Low"</td>
<td>61</td>
<td>1</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>"High"</td>
<td>84</td>
<td>1</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>"Low"</td>
<td>67</td>
<td>2</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>"High"</td>
<td>75</td>
<td>4</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>"Low"</td>
<td>57</td>
<td>5</td>
</tr>
<tr class="odd">
<td>"Fri"</td>
<td>"High"</td>
<td>81</td>
<td>5</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>"Low"</td>
<td>60</td>
<td>6</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"High"</td>
<td>71</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="d84ad303" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot with Day_int mapped to y; switch between commenting out lines 3 and 4 to see what happens</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data_test, p9.aes(x<span class="op">=</span><span class="st">'Temperature'</span>, y<span class="op">=</span><span class="st">'Day_int'</span>, color<span class="op">=</span><span class="st">'Temperature'</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">'Prototype 2'</span>, caption<span class="op">=</span><span class="st">'Continuous variable testing'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_reverse()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-13-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="extra-geom_path-testing" class="level3">
<h3 class="anchored" data-anchor-id="extra-geom_path-testing">Extra <code>geom_path</code> testing</h3>
<p>The continuous variable testing plot above hints at this but let’s take another look at what’s going on with <code>geom_path</code> and the color: calculate a midpoint between Low and High and then remake the plot with <code>geom_path</code>.</p>
<div id="aedc4d09" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> (</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    raw_data</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    .with_columns(Mid <span class="op">=</span> (pl.col(<span class="st">'High'</span>) <span class="op">+</span> pl.col(<span class="st">'Low'</span>)) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    .unpivot(index<span class="op">=</span>[<span class="st">'Day'</span>], on<span class="op">=</span>[<span class="st">'High'</span>, <span class="st">'Mid'</span>, <span class="st">'Low'</span>], variable_name<span class="op">=</span><span class="st">'Low/High'</span>, value_name<span class="op">=</span><span class="st">'Temperature'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    .sort([<span class="st">'Day'</span>, <span class="st">'Temperature'</span>], descending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plot_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (21, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Low/High</th>
<th data-quarto-table-cell-role="th">Temperature</th>
</tr>
<tr class="even">
<td>cat</td>
<td>str</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>"Low"</td>
<td>65.0</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>"Mid"</td>
<td>71.0</td>
</tr>
<tr class="odd">
<td>"Today"</td>
<td>"High"</td>
<td>77.0</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>"Low"</td>
<td>61.0</td>
</tr>
<tr class="odd">
<td>"Mon"</td>
<td>"Mid"</td>
<td>72.5</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Fri"</td>
<td>"Mid"</td>
<td>69.0</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>"High"</td>
<td>81.0</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"Low"</td>
<td>60.0</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>"Mid"</td>
<td>65.5</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"High"</td>
<td>71.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="523377b1" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data, p9.aes(x<span class="op">=</span><span class="st">'Temperature'</span>, y<span class="op">=</span><span class="st">'Day'</span>, color<span class="op">=</span><span class="st">'Temperature'</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">'Prototype 2'</span>, caption<span class="op">=</span><span class="st">'Color gradient testing'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(limits<span class="op">=</span>raw_data[<span class="st">'Day'</span>].reverse().to_list())</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-15-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="prototype-2-learnings" class="level2">
<h2 class="anchored" data-anchor-id="prototype-2-learnings">Prototype 2 learnings</h2>
<ol type="1">
<li>Rounded ends works for <code>geom_path</code></li>
<li><code>geom_path</code> does not change color until the next data point</li>
</ol>
<p>A color gradient is going to require some more work but <code>geom_path</code> looks like it has potential to do the job.</p>
</section>
</section>
<section id="temperature-info-prototypes" class="level1">
<h1>Temperature info prototypes</h1>
<p>Let’s move quickly through a couple prototypes that get all of the temperature info onto the plot.</p>
<p>We’ll use <code>geom_path</code> still, but we’re going to create a dataframe which has a row for every 0.1 degree between the Low and High temperatures on each day. This let’s us get a nice color gradient for the temperature range.</p>
<div id="f1093c46" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reminder: this is what raw_data looks like</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>raw_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Conditions</th>
</tr>
<tr class="even">
<td>cat</td>
<td>i64</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>65</td>
<td>77</td>
<td>"Cloudy"</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>61</td>
<td>84</td>
<td>"Sunny"</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>67</td>
<td>93</td>
<td>"Hot"</td>
</tr>
<tr class="even">
<td>"Wed"</td>
<td>59</td>
<td>76</td>
<td>"Drizzle"</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>54</td>
<td>75</td>
<td>"Windy"</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>57</td>
<td>81</td>
<td>"Partly cloudy"</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>60</td>
<td>71</td>
<td>"Heavy rain"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="3f17cc6b" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create "Temperature" column that is a list of values from Low to High by 0.1 increments</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> (</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    raw_data</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        Temperature <span class="op">=</span> pl.int_ranges(pl.col(<span class="st">'Low'</span>) <span class="op">*</span> <span class="dv">10</span>, pl.col(<span class="st">'High'</span>) <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element() <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">'Day'</span>, <span class="st">'Conditions'</span>, <span class="st">'Temperature'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    .explode(<span class="st">'Temperature'</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plot_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1_347, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Conditions</th>
<th data-quarto-table-cell-role="th">Temperature</th>
</tr>
<tr class="even">
<td>cat</td>
<td>str</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>65.0</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>65.1</td>
</tr>
<tr class="odd">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>65.2</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>65.3</td>
</tr>
<tr class="odd">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>65.4</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>70.6</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>70.7</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>70.8</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>70.9</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>71.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="color-gradient-prototype" class="level2">
<h2 class="anchored" data-anchor-id="color-gradient-prototype">Color gradient prototype</h2>
<p>Let’s use our exploded out dataframe and see if the color gradient works.</p>
<div id="8f90992f" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data, p9.aes(x<span class="op">=</span><span class="st">'Temperature'</span>, y<span class="op">=</span><span class="st">'Day'</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">"Color gradient prototype"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(p9.aes(color<span class="op">=</span><span class="st">'Temperature'</span>), size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(limits<span class="op">=</span>raw_data[<span class="st">'Day'</span>].reverse().to_list())</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-18-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The gradient looks good! We’ll change the color scale to something more appropriate to express temperature range later.</p>
</section>
<section id="full-temperature-prototype" class="level2">
<h2 class="anchored" data-anchor-id="full-temperature-prototype">Full temperature prototype</h2>
<p>Let’s add:</p>
<ol type="1">
<li>A 7-day range underneath the daily temperature range</li>
<li>Labels for the high and low temperatures to the plot</li>
</ol>
<p>For the 7-day range, I want something that’s underneath (on the z-axis) and a little larger than the temperature range. The effect I want is a thin border around the edges, especially at the extreme low and high temperatures. This means using a <code>geom_path</code> with a slightly larger <code>size</code> that spans from the lowest low temperature to the highest high temperature. Then, add the daily temperature ranges with another <code>geom_path</code> that layers on top. We’ll create a dataframe to make the underlayment easy to add.</p>
<p>For the temperature labels, we’ll use <code>geom_text</code> and create a dataframe with columns that can map to the <code>x</code>, <code>y</code>, and <code>label</code> aesthetics to make them easy to add. The labels will be placed to the left and right of the full 7-day temperature range for each day.</p>
<div id="09b3b921" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>low_high <span class="op">=</span> [raw_data.get_column(<span class="st">'Low'</span>).<span class="bu">min</span>(), raw_data.get_column(<span class="st">'High'</span>).<span class="bu">max</span>()]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>low_high</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>[54, 93]</code></pre>
</div>
</div>
<div id="91a843ab" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe for temperature range underlayment</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>temp_range <span class="op">=</span> pl.DataFrame({</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Day'</span>: raw_data.get_column(<span class="st">'Day'</span>),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Temperature'</span>: [low_high] <span class="op">*</span> <span class="bu">len</span>(raw_data)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>}).explode(<span class="st">'Temperature'</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>temp_range</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (14, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Temperature</th>
</tr>
<tr class="even">
<td>cat</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>54</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>93</td>
</tr>
<tr class="odd">
<td>"Mon"</td>
<td>54</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>93</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>54</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>93</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>54</td>
</tr>
<tr class="odd">
<td>"Fri"</td>
<td>93</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>54</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>93</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="b01f9077" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe for temperature labels; the offset used here will look better in the final plot</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>x_offset <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>temp_labels <span class="op">=</span> (</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    raw_data.lazy()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    .unpivot(index<span class="op">=</span>[<span class="st">'Day'</span>, <span class="st">'Conditions'</span>], on<span class="op">=</span>[<span class="st">'Low'</span>, <span class="st">'High'</span>], value_name<span class="op">=</span><span class="st">'temperature'</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">'temperature'</span>).cast(<span class="bu">str</span>) <span class="op">+</span> pl.lit(<span class="st">'°'</span>)).alias(<span class="st">'label'</span>),</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        pl.when(pl.col(<span class="st">'variable'</span>) <span class="op">==</span> <span class="st">'Low'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        .then(pl.lit(low_high[<span class="dv">0</span>]) <span class="op">-</span> x_offset)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        .otherwise(pl.lit(low_high[<span class="dv">1</span>]) <span class="op">+</span> x_offset)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'x'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">'Day'</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    .collect()</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>temp_labels</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (14, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Conditions</th>
<th data-quarto-table-cell-role="th">variable</th>
<th data-quarto-table-cell-role="th">temperature</th>
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th">x</th>
</tr>
<tr class="even">
<td>cat</td>
<td>str</td>
<td>str</td>
<td>i64</td>
<td>str</td>
<td>i32</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>"Low"</td>
<td>65</td>
<td>"65°"</td>
<td>49</td>
</tr>
<tr class="even">
<td>"Today"</td>
<td>"Cloudy"</td>
<td>"High"</td>
<td>77</td>
<td>"77°"</td>
<td>98</td>
</tr>
<tr class="odd">
<td>"Mon"</td>
<td>"Sunny"</td>
<td>"Low"</td>
<td>61</td>
<td>"61°"</td>
<td>49</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>"Sunny"</td>
<td>"High"</td>
<td>84</td>
<td>"84°"</td>
<td>98</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>"Hot"</td>
<td>"Low"</td>
<td>67</td>
<td>"67°"</td>
<td>49</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>"Windy"</td>
<td>"High"</td>
<td>75</td>
<td>"75°"</td>
<td>98</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>"Partly cloudy"</td>
<td>"Low"</td>
<td>57</td>
<td>"57°"</td>
<td>49</td>
</tr>
<tr class="odd">
<td>"Fri"</td>
<td>"Partly cloudy"</td>
<td>"High"</td>
<td>81</td>
<td>"81°"</td>
<td>98</td>
</tr>
<tr class="even">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>"Low"</td>
<td>60</td>
<td>"60°"</td>
<td>49</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>"Heavy rain"</td>
<td>"High"</td>
<td>71</td>
<td>"71°"</td>
<td>98</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="9d97d5a0" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data, p9.aes(x<span class="op">=</span><span class="st">'Temperature'</span>, y<span class="op">=</span><span class="st">'Day'</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">"Full temperature prototype"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(data<span class="op">=</span>temp_range, size<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'black'</span>, lineend<span class="op">=</span><span class="st">'round'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(p9.aes(color<span class="op">=</span><span class="st">'Temperature'</span>), size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_text(data<span class="op">=</span>temp_labels, mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'x'</span>, label<span class="op">=</span><span class="st">'label'</span>), ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(limits<span class="op">=</span>raw_data[<span class="st">'Day'</span>].reverse().to_list())</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-22-output-1.png" width="672" height="480" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="temperature-info-prototype-learnings" class="level2">
<h2 class="anchored" data-anchor-id="temperature-info-prototype-learnings">Temperature info prototype learnings</h2>
<ul>
<li>The color gradient in the temperature range and the underlayment work; we’ll adjust the colors for the final plot</li>
<li>The text labels are in place too: we’ll adjust the placement and font size in the final plot</li>
</ul>
</section>
</section>
<section id="final-plot" class="level1">
<h1>Final plot</h1>
<p>Let’s leave the weather icons for the very end and work on polishing this plot. This includes adjusting colors, placement, spacing, and sizes of elements and for a really polished plot, this part often takes the most time. I won’t go into detail about each adjustment, but will point out a few things below.</p>
<p>You’ll see a version of the plot without icons first, and then a version with icons.</p>
<section id="prep-data" class="level2">
<h2 class="anchored" data-anchor-id="prep-data">Prep data</h2>
<p>For convenience, here is all of the code to prep the data for the final plot in one place.</p>
<div id="29f1c299" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> pl.read_csv(<span class="st">'./data/7-day_forecast.csv'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>raw_data <span class="op">=</span> raw_data.with_columns(pl.col(<span class="st">'Day'</span>).cast(pl.Categorical))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>low_high <span class="op">=</span> [raw_data.get_column(<span class="st">'Low'</span>).<span class="bu">min</span>(), raw_data.get_column(<span class="st">'High'</span>).<span class="bu">max</span>()]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># daily temperature range data</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>plot_data <span class="op">=</span> (</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    raw_data</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        Temperature <span class="op">=</span> pl.int_ranges(pl.col(<span class="st">'Low'</span>) <span class="op">*</span> <span class="dv">10</span>, pl.col(<span class="st">'High'</span>) <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">1</span>).<span class="bu">list</span>.<span class="bu">eval</span>(pl.element() <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    .select(<span class="st">'Day'</span>, <span class="st">'Conditions'</span>, <span class="st">'Temperature'</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    .explode(<span class="st">'Temperature'</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># underlayment data</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>temp_range <span class="op">=</span> pl.DataFrame({</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Day'</span>: raw_data.get_column(<span class="st">'Day'</span>),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Temperature'</span>: [low_high] <span class="op">*</span> <span class="bu">len</span>(raw_data)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>}).explode(<span class="st">'Temperature'</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co"># text label data</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>x_offset <span class="op">=</span> <span class="dv">5</span>  <span class="co"># this is calculated dynamically in plot_forecast.py</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>temp_labels <span class="op">=</span> (</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    raw_data</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    .unpivot(index<span class="op">=</span>[<span class="st">'Day'</span>, <span class="st">'Conditions'</span>], on<span class="op">=</span>[<span class="st">'Low'</span>, <span class="st">'High'</span>], value_name<span class="op">=</span><span class="st">'temperature'</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    .with_columns(</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>        (pl.col(<span class="st">'temperature'</span>).cast(<span class="bu">str</span>) <span class="op">+</span> pl.lit(<span class="st">'°'</span>)).alias(<span class="st">'label'</span>),</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>        pl.when(pl.col(<span class="st">'variable'</span>) <span class="op">==</span> <span class="st">'Low'</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>        .then(pl.lit(low_high[<span class="dv">0</span>]) <span class="op">-</span> x_offset)</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>        .otherwise(pl.lit(low_high[<span class="dv">1</span>]) <span class="op">+</span> x_offset)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>        .alias(<span class="st">'x'</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    .sort(<span class="st">'Day'</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="plot-without-weather-icons" class="level2">
<h2 class="anchored" data-anchor-id="plot-without-weather-icons">Plot without weather icons</h2>
<p>Madison, WI is my current location and this is an actual 7-day forecast from late mid-June when I first started thinking about this. I did take some liberty on Tuesday to increase the high temperature for reasons you’ll see in the plot with icons. Check line 11 to see how I define the color gradient. I’ve left a gap for the weather icons to be added later, and this plot is going to get stretched out vertically.</p>
<p>You’ll notice that a lot of work happens in <code>theme()</code>. Also, there are a few variables I define at the top and these are where I spent more time trying out different settings. I had never used named colors from the <a href="https://matplotlib.org/stable/gallery/color/named_colors.html">xkcd color name survey</a> before, but you can use them by placing <code>xkcd:</code> before the color name.</p>
<p>Final comment here on the tweaks: I use Arial instead of Helvetica font. Look at the “Full temperature prototype” plot above and you might notice that some of the numbers look a little uneven. The “65°” text label in the upper-left is an example of this. I think the Helvetica font is getting rendered a little unevenly and Arial looks better. I tried 20 different fonts and settled on Arial.</p>
<div id="d7e0bac6" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>range_bg <span class="op">=</span> <span class="st">'xkcd:dark blue grey'</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>font_size <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>font_family <span class="op">=</span> <span class="st">'Arial'</span> <span class="co"># default is Helvetica; I think Arial looks a tiny bit better</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>plot <span class="op">=</span> (</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    p9.ggplot(plot_data, p9.aes(x<span class="op">=</span><span class="st">'Temperature'</span>, y<span class="op">=</span><span class="st">'Day'</span>))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.labs(title<span class="op">=</span><span class="st">"Madison, WI"</span>, subtitle<span class="op">=</span><span class="st">"7-day forecast"</span>, x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(data<span class="op">=</span>temp_range, size<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span>range_bg, lineend<span class="op">=</span><span class="st">'round'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_path(p9.aes(color<span class="op">=</span><span class="st">'Temperature'</span>), size<span class="op">=</span><span class="dv">8</span>, lineend<span class="op">=</span><span class="st">'round'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.geom_text(data<span class="op">=</span>temp_labels, mapping<span class="op">=</span>p9.aes(x<span class="op">=</span><span class="st">'x'</span>, label<span class="op">=</span><span class="st">'label'</span>), color<span class="op">=</span><span class="st">'white'</span>, size<span class="op">=</span>font_size, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_color_gradientn(colors<span class="op">=</span>[<span class="st">'deepskyblue'</span>, <span class="st">'aqua'</span>, <span class="st">'palegreen'</span>, <span class="st">'yellow'</span>, <span class="st">'orange'</span>, <span class="st">'red'</span>], limits<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">100</span>])</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.scale_y_discrete(limits<span class="op">=</span>raw_data[<span class="st">'Day'</span>].reverse().to_list(), expand<span class="op">=</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.4</span>))</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.theme_void()</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.theme(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        figure_size<span class="op">=</span>(<span class="fl">6.5</span>, <span class="fl">6.5</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        text<span class="op">=</span>p9.element_text(family<span class="op">=</span>font_family, color<span class="op">=</span><span class="st">'white'</span>),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        plot_background<span class="op">=</span>p9.element_rect(fill<span class="op">=</span><span class="st">'royalblue'</span>),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        plot_title<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">24</span>),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        plot_subtitle<span class="op">=</span>p9.element_text(size<span class="op">=</span><span class="dv">16</span>, ha<span class="op">=</span><span class="st">'center'</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        plot_margin<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        axis_text_y<span class="op">=</span>p9.element_text(angle<span class="op">=</span><span class="dv">0</span>, size<span class="op">=</span>font_size, va<span class="op">=</span><span class="st">'center'</span>, ha<span class="op">=</span><span class="st">'left'</span>, margin<span class="op">=</span>{<span class="st">'t'</span>: <span class="dv">0</span>, <span class="st">'r'</span>: <span class="dv">95</span>, <span class="st">'b'</span>: <span class="dv">0</span>, <span class="st">'l'</span>: <span class="dv">0</span>, <span class="st">'units'</span>: <span class="st">'pt'</span>}),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        axis_text_x<span class="op">=</span>p9.element_blank(),</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        legend_position<span class="op">=</span><span class="st">'none'</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-24-output-1.png" width="624" height="624" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-with-weather-icons" class="level2">
<h2 class="anchored" data-anchor-id="plot-with-weather-icons">Plot with weather icons</h2>
<p>Let’s take a quick look at using <code>watermark</code> to add <code>.png</code> images to a plot. The <code>watermark</code> feature takes the path to an image, and x and y pixel coordinates, then places the image with respect to the origin, <code>[0, 0]</code>, which is the bottom-left corner of the plot.</p>
<p>I didn’t expect it to work but I did try using an <code>.svg</code> image with <code>watermark</code> and it didn’t work.</p>
<div id="b72879f1" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add 3 weather icons to the plot in the bottom-left corner</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    plot</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.watermark(<span class="st">'./img/misc/weather-forecast/icons/drizzle_32px.png'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.watermark(<span class="st">'./img/misc/weather-forecast/icons/rain_32px.png'</span>, xo<span class="op">=</span><span class="dv">40</span>, yo<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> p9.watermark(<span class="st">'./img/misc/weather-forecast/icons/heavy_rain_32px.png'</span>, xo<span class="op">=</span><span class="dv">80</span>, yo<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="weather-forecast_files/figure-html/cell-25-output-1.png" width="624" height="624" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Since the coordinates are in pixels, this makes things a little trickier. To handle this, I created a version of the plot at a specific resolution to figure out where the place the icons for each day. I’m not going to output the plot since the placement probably will look off, but I’ll save the plot to a file and then display it in this jupyter notebook.</p>
<div id="304206fd" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>raw_data</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Day</th>
<th data-quarto-table-cell-role="th">Low</th>
<th data-quarto-table-cell-role="th">High</th>
<th data-quarto-table-cell-role="th">Conditions</th>
</tr>
<tr class="even">
<td>cat</td>
<td>i64</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Today"</td>
<td>65</td>
<td>77</td>
<td>"Cloudy"</td>
</tr>
<tr class="even">
<td>"Mon"</td>
<td>61</td>
<td>84</td>
<td>"Sunny"</td>
</tr>
<tr class="odd">
<td>"Tue"</td>
<td>67</td>
<td>93</td>
<td>"Hot"</td>
</tr>
<tr class="even">
<td>"Wed"</td>
<td>59</td>
<td>76</td>
<td>"Drizzle"</td>
</tr>
<tr class="odd">
<td>"Thu"</td>
<td>54</td>
<td>75</td>
<td>"Windy"</td>
</tr>
<tr class="even">
<td>"Fri"</td>
<td>57</td>
<td>81</td>
<td>"Partly cloudy"</td>
</tr>
<tr class="odd">
<td>"Sat"</td>
<td>60</td>
<td>71</td>
<td>"Heavy rain"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="6215816e" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plot_w_icons <span class="op">=</span> plot</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>xo <span class="op">=</span> <span class="dv">120</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>yo_max <span class="op">=</span> <span class="dv">509</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>yo_mod <span class="op">=</span> <span class="dv">78</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>rows <span class="op">=</span> raw_data.rows(named<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, row <span class="kw">in</span> <span class="bu">enumerate</span>(rows):</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    yo <span class="op">=</span> yo_max <span class="op">-</span> i <span class="op">*</span> yo_mod</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    plot_w_icons <span class="op">=</span> (</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        plot_w_icons </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> p9.watermark(<span class="ss">f'./img/misc/weather-forecast/icons/</span><span class="sc">{</span>row[<span class="st">"Conditions"</span>]<span class="sc">.</span>lower()<span class="sc">.</span>replace(<span class="st">" "</span>, <span class="st">"_"</span>)<span class="sc">}</span><span class="ss">_32px.png'</span>, xo<span class="op">=</span>xo, yo<span class="op">=</span>yo)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<!-- Here's the final plot: -->
<!---->
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/misc/weather-forecast/weather.png" class="img-fluid figure-img"></p>
<figcaption>7-day forecast</figcaption>
</figure>
</div>
<p>I think this is a satisfying detail: zoom into the extreme low or high temperature on the plot and see the border formed by the underlayment around the temperature range.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/misc/weather-forecast/plot_zoom.png" class="img-fluid figure-img"></p>
<figcaption>plot zoom</figcaption>
</figure>
</div>
</section>
</section>
<section id="concluding-notes" class="level1">
<h1>Concluding notes</h1>
<p>I put the code to generate the plot in a function in <code>plot_forecast.py</code>; the function doesn’t have data validation or error checking. You can run <code>from plot_forecast import plot_forecast</code>, then call <code>plot_forecast(forecast, location, outfile)</code> to generate a plot.</p>
<p>While testing out <code>plot_forecast</code> on a wider range of data, I found some things to tweak:</p>
<ul>
<li>I adjusted <code>scale_color_gradientn</code> to tweak the colors
<ul>
<li>My original colors gave less contrast that I wanted at the colder temperatures</li>
<li>Note that I’m working in Fahrenheit and if you want to use Celsius, adjust the color scale accordingly</li>
</ul></li>
<li>The offset for the temperature labels is now calculated dynamically; a narrow temperature range with the static offset messed with the spacing of elements</li>
<li>I added a call to <code>scale_x_continuous</code>: without it, temperatures with 3 digits were slightly clipped</li>
</ul>
<p>I included 11 weather icons but there are additional weather icons available in the Bootstrap Icons library.</p>
<p>I learned some new things while working on this. If you went through this notebook, I hope you did too.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/plotnine\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>